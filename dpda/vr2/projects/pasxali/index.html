<html>

<head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.0.0/dist/aframe-extras.min.js"></script>
    <script>
        var count = 0, coords;
        AFRAME.registerComponent('flying', {
            init: function () {
                coords = document.getElementById('cam');
                document.querySelector('a-scene').addEventListener('enter-vr', function () { coords = document.getElementById('rig'); });
                document.querySelector('a-scene').addEventListener('exit-vr', function () { coords = document.getElementById('cam'); });
            },
            tick: function () {
                var pos1 = coords.getAttribute('position');
                var pos2 = this.el.getAttribute('position');
                if (Math.abs(pos1.x - pos2.x) < 1 && Math.abs(pos1.z - pos2.z) < 1) {
                    this.el.remove();
                    document.getElementById('counter').setAttribute('value', 'Score: ' + ++count);
                }
                if (Math.random() < 0.95) return;
                var x = Math.random() * 600 - 300;
                var z = Math.random() * 600 - 300;
                this.el.setAttribute('animation', 'property: position; to: ' + x + ' 2.5 ' + z + '; dur: 10000');
            }
        });
    </script>
    <script src="https://gftruj.github.io/webzamples/aframe/controls/oculus-thumbstick-controls.js"></script>
</head>

<body>
    <a-scene id="s1" background="color:#0d0928" fog="far:300" shadow="type: pcfsoft">
        <a-entity id="rig">
            <a-camera id="cam" position="0 3 0">
                <a-text id="counter" value="Score: 0" geometry="primitive: plane; width: 0; height: 1"
                    position="-0.5 0.5 -1" material="opacity: 0"></a-text>
            </a-camera>
            <a-entity oculus-touch-controls="hand: right" oculus-thumbstick-controls></a-entity>
        </a-entity>
        <a-sphere radius="500" position="0 5000 0" material="fog: false"></a-sphere>
        <a-entity
            light="type: directional; intensity: 0.5; castShadow: true; shadowCameraBottom: -500; shadowCameraTop: 500; shadowCameraLeft: -500; shadowCameraRight: 500"
            position="0 250 0"></a-entity>
        <a-light type="ambient" intensity="0.25"></a-light>
        <a-assets>
            <a-asset-item id="tree" src="tree.gltf"></a-asset-item>
            <a-asset-item id="butterfly" src="animated_butterfly.glb"></a-asset-item>
        </a-assets>
        <a-plane color="#2a1c0e" height="1000" width="1000" rotation="-90 0 0" metalness="0" shadow></a-plane>
    </a-scene>
    <script>
        var scene1 = document.getElementById('s1');
        for (var i = 0; i < 500; i++) {
            var tree = document.createElement('a-entity');
            var x = Math.random() * 800 - 400;
            var z = Math.random() * 800 - 400;
            var s = Math.random() * 15 + 5;
            var r = Math.random() * 180 - 90;
            tree.setAttribute('gltf-model', '#tree');
            tree.setAttribute('position', x + ' 0 ' + z);
            tree.setAttribute('scale', s + ' ' + s + ' ' + s);
            tree.setAttribute('rotation', '0 ' + r + ' 0');
            tree.setAttribute('shadow', 'receive: false');
            scene1.appendChild(tree);
        }
        for (var i = 0; i < 100; i++) {
            var butterfly = document.createElement('a-entity');
            var x = Math.random() * 600 - 300;
            var z = Math.random() * 600 - 300;
            var r = Math.random() * 180 - 90;
            butterfly.setAttribute('gltf-model', '#butterfly');
            butterfly.setAttribute('position', x + ' 2.5 ' + z);
            butterfly.setAttribute('scale', '0.5 0.5 0.5');
            butterfly.setAttribute('rotation', '0 ' + r + ' 0');
            butterfly.setAttribute('animation-mixer', '');
            butterfly.setAttribute('flying', '');
            scene1.appendChild(butterfly);
        }
    </script>
</body>

</html>
