<html>

<head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://c-frame.github.io/aframe-physics-system/dist/aframe-physics-system.js"></script>
    <script src="https://gftruj.github.io/webzamples/aframe/controls/oculus-thumbstick-controls.js"></script>
    <script>
        var ghosts = 10;
        
        AFRAME.registerComponent('collider-check', {
            dependencies: ['raycaster'],
            init: function () {
                this.el.addEventListener('raycaster-intersection', function () {
                    console.log('Player hit something!');
                });
            }
        });
        AFRAME.registerComponent('colliding', {
            init: function () {
                var el = this.el;
                el.addEventListener('collide', function (e) {
                    console.log(e.detail.body.id);
                });
            }
        });
        AFRAME.registerComponent('flying', {
            tick: function () {
                if (Math.random() < 0.5) return;
                var el = this.el;
                var x = Math.random() * 500 - 250;
                var y = Math.random() * 25 + 1000;
                var z = Math.random() * 500 - 250;
                el.setAttribute('animation', 'property: position; to: ' + x + ' ' + y + ' ' + z);
            }
        });
    </script>
</head>

<body>
    <a-scene id="s1" physics>
        <a-assets>
            <a-asset-item id="ghost" src="ghost.gltf"></a-asset-item>
            <a-asset-item id="b9" src="b9.gltf"></a-asset-item>
        </a-assets>
        <a-sky radius="5000" src="eso0932a.jpg"></a-sky>
        <a-sphere radius="1000" src="flat_earth03.jpg" position="0 1000 0"
            animation="property: rotation; to: -60 300 0; dur: 25000">
        </a-sphere>
        <a-ring color="#111" radius-inner="0" radius-outer="990" position="0 1000 0" rotation="-90 0 0">
            <a-plane static-body color="#111" height="600" width="600"></a-plane>
        </a-ring>
        <a-light color="#BBB" intensity="0.1" type="ambient"></a-light>
        <a-entity id="rig">
            <a-camera id="cam" position="0 1000 4500"
                animation="property: position; to: 0 1010 300; dur: 25000">
                <a-entity collider-check raycaster="objects: .collidable; showLine:true"></a-entity>
                <a-sphere static-body colliding></a-sphere>
            </a-camera>
            <a-entity oculus-touch-controls="hand: right" oculus-thumbstick-controls></a-entity>
        </a-entity>
    </a-scene>
    <script>
        var scene1 = document.getElementById('s1');
        for (var i = -250; i < 250; i += 50) {
            for (var j = -250; j < 250; j += 50) {
                var b = document.createElement('a-entity');
                b.setAttribute('gltf-model', '#b9');
                b.setAttribute('dynamic-body', '');
                b.setAttribute('scale', '25 25 25');
                b.setAttribute('position', i + ' 1015 ' + j);
                scene1.appendChild(b);
            }
        }
        for (var i = 0; i < 10; i++) {
            var ghost = document.createElement('a-entity');
            var x = Math.random() * 500 - 250;
            var y = Math.random() * 25 + 1000;
            var z = Math.random() * 500 - 250;
            var r = Math.random() * 180 - 90;
            ghost.setAttribute('gltf-model', '#ghost');
            ghost.setAttribute('scale', '250 250 250');
            ghost.setAttribute('position', x + ' ' + y + ' ' + z);
            ghost.setAttribute('rotation', '0 ' + r + ' 0');
            ghost.setAttribute('class', 'collidable');
            ghost.setAttribute('flying', '');
            scene1.appendChild(ghost);
        }
    </script>
</body>

</html>
